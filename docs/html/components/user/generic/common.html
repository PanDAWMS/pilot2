
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>common &#8212; Pilot 2  documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="container" href="container.html" />
    <link rel="prev" title="generic components" href="index.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-pilot.user.generic.common">
<span id="common"></span><h1>common<a class="headerlink" href="#module-pilot.user.generic.common" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="pilot.user.generic.common.get_analysis_run_command">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_analysis_run_command</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trf_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_analysis_run_command"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_analysis_run_command" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the proper run command for the user job.</p>
<p>Example output: export X509_USER_PROXY=&lt;..&gt;;./runAthena &lt;job parameters&gt; –usePFCTurl –directIn</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>trf_name</strong> – name of the transform that will run the job (string). Used when containers are not used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>command (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.get_metadata">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_metadata</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">workdir</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the metadata from file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>workdir</strong> – work directory (string)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.get_payload_command">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_payload_command</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_payload_command"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_payload_command" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the full command for executing the payload, including the sourcing of all setup files and setting of
environment variables.</p>
<p>By default, the full payload command is assumed to be in the job.jobparams.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>command (string)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.get_utility_command_execution_order">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_utility_command_execution_order</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_utility_command_execution_order"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_utility_command_execution_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Should the given utility command be executed before or after the payload?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – utility name (string).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>execution order constant (UTILITY_BEFORE_PAYLOAD or UTILITY_AFTER_PAYLOAD)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.get_utility_command_kill_signal">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_utility_command_kill_signal</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_utility_command_kill_signal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_utility_command_kill_signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the proper kill signal used to stop the utility command.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>kill signal</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.get_utility_command_output_filename">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_utility_command_output_filename</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_utility_command_output_filename"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_utility_command_output_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the filename to the output of the utility command.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – utility name (string).</p></li>
<li><p><strong>selector</strong> – optional special conditions flag (boolean).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>filename (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.get_utility_command_setup">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_utility_command_setup</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setup</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_utility_command_setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_utility_command_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the proper setup for the given utility command.
If a payload setup is specified
:param name:
:param setup:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.get_utility_commands">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">get_utility_commands</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#get_utility_commands"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.get_utility_commands" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of utility commands and arguments to be executed in parallel with the payload.
This could e.g. be memory and network monitor commands. A separate function can be used to determine the
corresponding command setups using the utility command name.
If the optional order parameter is set, the function should return the list of corresponding commands.
E.g. if order=UTILITY_BEFORE_PAYLOAD, the function should return all commands that are to be executed before the
payload. If order=UTILITY_WITH_PAYLOAD, the corresponding commands will be prepended to the payload execution
string. If order=UTILITY_AFTER_PAYLOAD, the commands that should be executed after the payload has been started
should be returned.</p>
<p>FORMAT: {‘command’: &lt;command&gt;, ‘args’: &lt;args&gt;}</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order</strong> – optional sorting order (see pilot.util.constants)</p></li>
<li><p><strong>job</strong> – optional job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary of utilities to be executed in parallel with the payload.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.post_utility_command_action">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">post_utility_command_action</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#post_utility_command_action"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.post_utility_command_action" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform post action for given utility command.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – name of utility command (string).</p></li>
<li><p><strong>job</strong> – job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.remove_redundant_files">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">remove_redundant_files</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">workdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfiles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">islooping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#remove_redundant_files"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.remove_redundant_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove redundant files and directories prior to creating the log file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>workdir</strong> – working directory (string).</p></li>
<li><p><strong>outputfiles</strong> – list of output files.</p></li>
<li><p><strong>islooping</strong> – looping job variable to make sure workDir is not removed in case of looping (boolean).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.sanity_check">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">sanity_check</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#sanity_check"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.sanity_check" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an initial sanity check before doing anything else in a given workflow.
This function can be used to verify importing of modules that are otherwise used much later, but it is better to abort
the pilot if a problem is discovered early.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>exit code (0 if all is ok, otherwise non-zero exit code).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.update_job_data">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">update_job_data</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#update_job_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.update_job_data" title="Permalink to this definition">¶</a></dt>
<dd><p>This function can be used to update/add data to the job object.
E.g. user specific information can be extracted from other job object fields. In the case of ATLAS, information
is extracted from the metaData field and added to other job object fields.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.update_server">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">update_server</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#update_server"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.update_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform any user specific server actions.</p>
<p>E.g. this can be used to send special information to a logstash.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.update_stagein">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">update_stagein</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#update_stagein"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.update_stagein" title="Permalink to this definition">¶</a></dt>
<dd><p>In case special files need to be skipped during stage-in, the job.indata list can be updated here.
See ATLAS code for an example.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.validate">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">validate</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#validate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform user specific payload/job validation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Boolean (True if validation is successful).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.user.generic.common.verify_job">
<code class="sig-prename descclassname"><span class="pre">pilot.user.generic.common.</span></code><code class="sig-name descname"><span class="pre">verify_job</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/pilot/user/generic/common.html#verify_job"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pilot.user.generic.common.verify_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify job parameters for specific errors.
Note:</p>
<blockquote>
<div><p>in case of problem, the function should set the corresponding pilot error code using
job.piloterrorcodes, job.piloterrordiags = errors.add_error_code(error.get_error_code())</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Boolean.</p>
</dd>
</dl>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Pilot 2</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">api components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../common/index.html">common components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../control/index.html">control components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../copytool/index.html">copytool components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../eventservice/index.html">eventservice components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../info/index.html">info components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resource/index.html">resource components</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">user components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../util/index.html">util components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../workflow/index.html">workflow components</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Components</a><ul>
  <li><a href="../index.html">user components</a><ul>
  <li><a href="index.html">generic components</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">generic components</a></li>
      <li>Next: <a href="container.html" title="next chapter">container</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/components/user/generic/common.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Paul Nilsson, Mario Lassnig, Daniil Drizhuk, ....
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/components/user/generic/common.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>